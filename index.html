<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Garage Mini POS</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Login -->
  <section id="auth" class="container center">
    <div class="card narrow">
      <h2>Đăng nhập</h2>
      <p class="muted">Tài khoản mặc định: <b>admin</b> — Mật khẩu: <b>1234</b></p>
      <label>Tài khoản</label><input id="login-user" placeholder="admin" autocomplete="username">
      <label>Mật khẩu</label><input id="login-pass" type="password" placeholder="••••" autocomplete="current-password">
      <div class="row">
        <button class="btn btn-primary grow" id="btn-login">Đăng nhập</button>
        <button class="btn btn-ghost grow" id="btn-fill">Điền mặc định</button>
      </div>
    </div>
  </section>

  <!-- App -->
  <section id="app" style="display:none">
    <header class="topbar" id="topbar">
      <div class="container">
        <div class="row" style="align-items:center">
          <div class="title grow">Garage Mini POS</div>
          <button class="btn btn-ghost no-print toggle-btn" id="btn-toggle-header" title="Thu gọn/mở rộng" style="width:auto">⌃ Thu gọn</button>
          <button class="btn btn-warning no-print" id="btn-logout" style="width:auto">Đăng xuất</button>
        </div>

        <!-- NAV WRAP (có thể ẩn/hiện) -->
        <div id="nav-wrap">
          <!-- Tabs (Desktop) -->
          <div class="tabs no-print">
            <button class="tab-btn active" data-tab="products">Sản phẩm</button>
            <button class="tab-btn" data-tab="sell">Bán nhanh</button>
            <button class="tab-btn" data-tab="invoice">Khách nhiều phụ tùng</button>
            <button class="tab-btn" data-tab="history">Hóa đơn đã lưu</button>
            <button class="tab-btn" data-tab="settings">Cài đặt</button>
          </div>

          <!-- Dropdown (Mobile) -->
          <div class="tab-dropdown no-print">
            <select id="tab-select" aria-label="Chọn chức năng">
              <option value="products">Sản phẩm</option>
              <option value="sell">Bán nhanh</option>
              <option value="invoice" selected>Khách nhiều phụ tùng</option>
              <option value="history">Hóa đơn đã lưu</option>
              <option value="settings">Cài đặt</option>
            </select>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <!-- PRODUCTS -->
      <section id="tab-products">
        <div class="filters no-print">
          <select id="filter-category" style="flex:1">
            <option value="all">Tất cả danh mục</option>
            <option value="nhot">Nhớt</option>
            <option value="voxe">Vỏ xe</option>
          </select>
          <input id="search" placeholder="Tìm theo tên, hãng..." style="flex:2" />
          <button id="btn-add-product" class="btn btn-secondary" style="width:auto">+ Thêm sản phẩm</button>
          <button id="btn-reset" class="btn btn-danger" style="width:auto">Cài lại dữ liệu mẫu</button>
        </div>
        <div id="products-grid" class="grid"></div>
      </section>

      <!-- QUICK SELL -->
      <section id="tab-sell" style="display:none">
        <div class="card">
          <div class="row" style="align-items:center;margin-bottom:10px">
            <div class="grow">
              <div class="section-title">Bán nhanh 1 món</div>
              <div class="muted">Chọn sản phẩm, xác nhận → Tồn kho trừ <b>1</b>.</div>
            </div>
            <div class="pill">Số mặt hàng trong kho: <b id="stock-count">0</b></div>
          </div>
          <div class="row">
            <select id="quick-product" class="grow"></select>
            <button class="btn btn-primary" id="btn-quick-sell" style="width:auto">Bán ngay</button>
          </div>
        </div>
      </section>

      <!-- INVOICE -->
      <section id="tab-invoice" style="display:none">
        <div class="card">
          <div class="row">
            <div class="grow"><label>Tên khách hàng</label><input id="cust-name" placeholder="VD: Nguyễn Văn A"></div>
            <div class="grow"><label>SĐT</label><input id="cust-phone" placeholder="VD: 09xx..." ></div>
          </div>
          <div class="row">
            <div class="grow"><label>Biển số xe <span class="req">*</span></label><input id="cust-plate" placeholder="VD: 59X3-123.45" required></div>
            <div class="grow"><label>Ghi chú</label><textarea id="cust-note" placeholder="VD: Nhắc tái thay nhớt sau 2000km"></textarea></div>
          </div>

          <div class="row" style="margin-top:10px">
            <div class="seg" style="width:100%">
              <button id="seg-stock" class="active">Chọn từ kho</button>
              <button id="seg-manual">Nhập tay</button>
            </div>
          </div>

          <!-- Từ kho -->
          <div id="from-stock" style="margin-top:8px">
            <div class="row">
              <div class="grow"><label>Chọn sản phẩm</label><select id="inv-product"></select></div>
              <div style="width:120px"><label>SL</label><input id="inv-qty" type="number" value="1" min="1"></div>
              <div style="width:160px"><label>Đơn giá (cho phép sửa)</label><input id="inv-price" type="number" value="0" min="0"></div>
              <div style="width:160px"><label>&nbsp;</label><button class="btn btn-secondary" id="btn-add-line">+ Thêm</button></div>
            </div>
          </div>

          <!-- Nhập tay -->
          <div id="from-manual" style="display:none;margin-top:8px">
            <div class="row">
              <div class="grow"><label>Tên / Loại sản phẩm thay</label><input id="man-name" placeholder="VD: Công thay nhớt, Vỏ 90/90-14"></div>
              <div style="width:120px"><label>SL</label><input id="man-qty" type="number" value="1" min="1"></div>
              <div style="width:160px"><label>Đơn giá</label><input id="man-price" type="number" value="0" min="0"></div>
              <div style="width:160px"><label>&nbsp;</label><button class="btn btn-secondary" id="btn-add-manual">+ Thêm</button></div>
            </div>
          </div>

          <!-- Bảng hóa đơn -->
          <div style="margin-top:10px">
            <table>
              <thead>
                <tr>
                  <th>Loại Sản Phẩm Thay</th>
                  <th style="width:100px">SL</th>
                  <th style="width:140px">Đơn giá</th>
                  <th style="width:160px">Thành tiền</th>
                  <th style="width:60px"></th>
                </tr>
              </thead>
              <tbody id="invoice-body"></tbody>
              <tfoot>
                <tr><td colspan="3" style="text-align:right">Tổng (hạng mục)</td><td id="invoice-subtotal">0 ₫</td><td></td></tr>
                <tr><td colspan="3" style="text-align:right">Chiết khấu</td><td><input id="discount" type="number" min="0" value="0"></td><td></td></tr>
                <tr><td colspan="3" style="text-align:right">Công thợ</td><td><input id="labor" type="number" min="0" value="0"></td><td></td></tr>
                <tr><td colspan="3" style="text-align:right">VAT (%)</td><td><input id="vat" type="number" min="0" max="100" value="0"></td><td></td></tr>
                <tr><td colspan="3" style="text-align:right"><b>Tổng cuối</b></td><td id="invoice-total">0 ₫</td><td></td></tr>
              </tfoot>
            </table>
          </div>

          <div class="right no-print" style="margin-top:8px">
            <button class="btn btn-ghost" id="btn-clear-invoice" style="width:auto">Xóa hết</button>
            <button class="btn btn-warning" id="btn-print" style="width:auto">In / Lưu PDF</button>
            <button class="btn btn-ghost" id="btn-export-csv" style="width:auto">Xuất CSV</button>
            <button class="btn btn-ghost" id="btn-export-xlsx" style="width:auto">Xuất Excel (.xlsx)</button>
            <button class="btn btn-primary" id="btn-save-invoice" style="width:auto">Lưu hóa đơn</button>
          </div>
        </div>

        <!-- Khung in -->
        <div id="invoice-print" class="card" style="margin-top:16px">
          <div style="text-align:center">
            <div class="brandline">
              <img id="p-logo" src="" alt="logo" style="display:none"/>
              <div>
                <h2 style="margin:0" id="p-gname">HÓA ĐƠN SỬA CHỮA</h2>
                <div class="muted" id="p-gaddr">Garage Mini POS</div>
                <div class="muted" id="p-ghotline"></div>
              </div>
            </div>
          </div>
          <div class="row" style="margin:8px 0;gap:8px">
            <div class="grow">Khách: <b id="p-name">—</b></div>
            <div>SĐT: <b id="p-phone">—</b></div>
            <div>Biển số: <b id="p-plate">—</b></div>
          </div>
          <table>
            <thead><tr><th>Loại Sản Phẩm Thay</th><th>SL</th><th>Đơn giá</th><th>Thành tiền</th></tr></thead>
            <tbody id="p-body"></tbody>
            <tfoot>
              <tr><td colspan="3" style="text-align:right">Tổng (hạng mục)</td><td id="p-subtotal">0 ₫</td></tr>
              <tr><td colspan="3" style="text-align:right">Chiết khấu</td><td id="p-discount">0 ₫</td></tr>
              <tr><td colspan="3" style="text-align:right">Công thợ</td><td id="p-labor">0 ₫</td></tr>
              <tr><td colspan="3" style="text-align:right">VAT</td><td id="p-vat">0 ₫</td></tr>
              <tr><td colspan="3" style="text-align:right"><b>Tổng cuối</b></td><td id="p-total">0 ₫</td></tr>
            </tfoot>
          </table>
          <div id="p-note" style="margin-top:6px"></div>
          <div class="muted center-text">Cảm ơn quý khách!</div>
        </div>
      </section>

      <!-- HISTORY -->
      <section id="tab-history" style="display:none">
        <div class="card">
          <div class="section-title">Hóa đơn đã lưu</div>
          <div id="history-list"></div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="tab-settings" style="display:none">
        <div class="card">
          <div class="section-title">Cài đặt cửa hàng & Branding</div>
          <div class="row">
            <div class="grow"><label>Tên Garage / Tiêu đề in</label><input id="set-name" placeholder="VD: GARAGE HK"></div>
            <div class="grow"><label>Địa chỉ</label><input id="set-addr" placeholder="VD: 123 Trần Quang Khải, Q1"></div>
          </div>
          <div class="row">
            <div class="grow"><label>Hotline</label><input id="set-hotline" placeholder="VD: 09xx xxx xxx"></div>
            <div class="grow"><label>Logo URL</label><input id="set-logo" placeholder="Dán link ảnh (png/jpg)"></div>
          </div>
          <div class="row">
            <div class="grow"><label>Màu chủ đạo</label><input id="set-brand" type="color" value="#2563eb"></div>
            <div class="grow"><label>Màu phụ</label><input id="set-brand2" type="color" value="#10b981"></div>
            <div class="grow"><label>Màu nhấn</label><input id="set-accent" type="color" value="#f59e0b"></div>
          </div>

          <div class="section-title" style="margin-top:10px">QR Chuyển khoản (VietQR)</div>
          <div class="row">
            <div class="grow"><label>Mã ngân hàng (VD: MB)</label><input id="qr-bank" placeholder="MB"></div>
            <div class="grow"><label>Số tài khoản</label><input id="qr-acc" placeholder="VD: 0123456789"></div>
          </div>
          <div class="row">
            <div class="grow"><label>Tên tài khoản</label><input id="qr-name" placeholder="VD: NGUYEN VAN A"></div>
            <div class="grow"><label>Số tiền (VND)</label><input id="qr-amount" type="number" min="0" value="0"></div>
          </div>
          <div class="row">
            <div class="grow"><label>Nội dung chuyển khoản</label><input id="qr-note" placeholder="VD: Sua xe/59X3-123.45"></div>
            <div style="width:160px;align-self:end"><button id="btn-show-qr" class="btn btn-secondary" style="width:100%">Tạo QR</button></div>
          </div>
          <div id="qr-preview-wrap" class="center" style="margin-top:8px;display:none">
            <img id="qr-preview" alt="QR chuyển khoản" style="width:220px;height:220px;background:#fff;border:1px solid #e5e7eb;border-radius:12px" />
            <div class="muted" id="qr-caption" style="margin-top:6px"></div>
          </div>

          <div class="right" style="margin-top:10px">
            <button class="btn btn-secondary" id="btn-save-settings" style="width:auto">Lưu cài đặt</button>
          </div>
        </div>
      </section>
    </main>
  </section>

  <!-- Add/Edit Product Sheet -->
  <div class="sheet" id="sheet-add">
    <div class="panel">
      <div class="row" style="align-items:center;margin-bottom:8px">
        <h3 class="grow" style="margin:0">Thêm / sửa sản phẩm</h3>
        <button class="btn btn-ghost" id="close-add" style="width:auto">Đóng</button>
      </div>
      <div class="row">
        <div class="grow"><label>Danh mục</label>
          <select id="ap-category"><option value="nhot">Nhớt</option><option value="voxe">Vỏ xe</option></select>
        </div>
        <div class="grow"><label>Hãng / Tên</label><input id="ap-name" placeholder="VD: Motul 7100 10W40"></div>
      </div>
      <div class="row">
        <div class="grow"><label>Giá (₫)</label><input id="ap-price" type="number" placeholder="VD: 180000"></div>
        <div class="grow"><label>Số lượng</label><input id="ap-qty" type="number" value="1" min="0"></div>
      </div>
      <div><label>Ảnh (URL) — tùy chọn</label><input id="ap-img" placeholder="Dán link ảnh sản phẩm (jpg/png)"></div>
      <div class="right" style="margin-top:12px">
        <button class="btn btn-secondary" id="ap-save" style="width:auto">Lưu</button>
      </div>
    </div>
  </div>

  <!-- Confirm Sell Sheet -->
  <div class="sheet" id="sheet-sell">
    <div class="panel">
      <div class="row" style="align-items:center;margin-bottom:8px">
        <h3 class="grow" style="margin:0">Xác nhận bán</h3>
        <button class="btn btn-ghost" id="close-sell" style="width:auto">Đóng</button>
      </div>
      <div id="sell-info" class="muted" style="margin-bottom:10px"></div>
      <div class="right">
        <button class="btn btn-primary" id="sell-confirm" style="width:auto">Đã bán ( -1 )</button>
      </div>
    </div>
  </div>

  <!-- SheetJS for XLSX -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
